.. UserDPP.rst --- 
.. 
.. Description: 
.. Author: Hongyi Wu(吴鸿毅)
.. Email: wuhongyi@qq.com 
.. Created: 二 10月  1 23:34:53 2024 (+0800)
.. Last-Updated: 五 2月  7 20:07:46 2025 (+0800)
..           By: Hongyi Wu(吴鸿毅)
..     Update #: 5
.. URL: http://wuhongyi.cn 

##################################################
UserDPP 固件
##################################################

**吴鸿毅开发固件，本固件侧重于特殊算法的实现。**

目前支持 2740/2745/2730 固件定制，欢迎有特殊固件需求的老师联系我们。



2730 的固件，FPGA 运行时钟为 125 MHz。每个时钟的四个采样点相加作为一个采样点处理。


============================================================
基本参数配置
============================================================


----------------------------------------------------------------------
输入信号
----------------------------------------------------------------------

.. image:: /_static/img/userdpp_basic_input.png


:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
参数 ChEnable
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

独立设定每个通道是否开启使用。如果通道不启用，它不提供任何数据，同时它的自触发也关闭。


:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
参数 DCOffset
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

  
当输入信号为正极性时，DCOffset 0% 为道址 0；当输入信号为负极性时， DCOffset 100% 时为道址 0。



----------------------------------------------------------------------
UserDPP
----------------------------------------------------------------------


.. image:: /_static/img/userdpp_basic_userdpp.png


:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
参数 Polarity
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
  
当输入信号为正极性时设置为 1，负极性时设置为 0。


:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
参数 FL
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
  
XIA fast filter 的参数，快梯形滤波参数

FL 单位为 8 ns。可设置参数为 1-127



:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
参数 FL+FG
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
  
快梯形滤波参数

FL+FG 单位为 8 ns，参数需大于等于 FL。可设置参数为 1-127


:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
参数 Threshold
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
  
快梯形滤波的触发阈值


:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
参数 Pre-trigger
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

当记录波形时候，触发前的长度

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::  
参数 Wave Length
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

当参数值大于 0 时，则记录波形

单位为 4 个采样点。  

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
参数 DataFormat
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

当参数为 0 时，只输出时间，QDC 等信息。

当参数为 1 时，额外输出 RT 参数，梯形三段积分等信息。


:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::  
参数 Qoffset
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

QDC 积分的触发延迟。 单位为 8 ns

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::  
参数 Qshort
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

QDC 积分短门。 单位为 8 ns

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::  
参数 Qlong
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::


QDC 积分长门。 单位为 8 ns



:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::  
参数 QGainShift
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

QDC 积分短门、长门积分数值，输出前向右移位。用来调节能谱增益。

可设置参数为 0-7

  

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
参数 2^n BL
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

移动平均计算基线，参与平均点的个数为 2^n

可设置参数 1-10

  

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::  
参数 BL Hold
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::


基线计算抑制。当当前触发与上一个触发间隔大于设置参数时，更新基线数值。
  
单位为 8 ns

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
参数 RT offset
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

RT 鉴别算法积分起点偏置。单位为 8 ns

  
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
参数 RT gate
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

RT 鉴别算法积分门。单位为 8 ns  

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
参数 XIAoffset
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

此参数为 SL+SG 减去触发前保留的采样点


单位为 8 ns

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
参数 SL
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

梯形参数的上升沿长度。

单位为 8 ns  

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::  
参数  SG
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

梯形参数的平台长度。

单位为 8 ns






============================================================
逻辑参数配置
============================================================




   
.. 
.. UserDPP.rst ends here
